# Copilot・自動生成ツール向け ドキュメント作成指示

ドキュメントを作成・編集する際は、以下のルールを厳守してください。

## 作業前の確認事項

ドキュメントを作成・更新する前に、必ず以下を確認してください：

1. このファイル内のチェックリストを確認（「新規ドキュメント作成時のチェックリスト」「既存ドキュメント更新時のチェックリスト」）
2. 対象ドキュメントの責任分掌を確認（次のセクションを参照）

## ドキュメントの責任分掌

各ドキュメントには明確な役割があります。内容を適切なファイルに配置してください：

### README.md

- **目的**: ユーザー向けクイックスタートガイド
- **内容**: 
  - プロジェクトの概要
  - 必要な環境設定の概要
  - 基本的な実行手順
  - 高レベルの機能説明
- **避けるべき内容**: 詳細な技術仕様、詳細なトラブルシューティング、内部アーキテクチャ

### .github/workflows/README.md

- **目的**: ワークフローの詳細ドキュメント
- **内容**:
  - 各ワークフローの概要説明
  - トリガー条件の詳細
  - 必要な環境変数と権限
  - 動作の詳細
  - トラブルシューティング
- **理由**: 
  - GitHub上で`.github/workflows/`ディレクトリを開いた際に自動表示される
  - ワークフローファイルと同じ場所に説明があり、一元管理しやすい
  - 別ファイル（docs/）へのナビゲーションが不要で視認性が高い
- **注意**: 
  - 特定のワークフローが非常に複雑で、独立したドキュメントが必要な場合のみ`docs/`配下に専門ドキュメントを作成する（例: `docs/RELEASE_FLOW.md`）

### docs/*.md（専門ドキュメント）

- **目的**: 複数のファイル・コンポーネントにまたがる複雑な機能の詳細説明
- **原則**: **基本的には関連ファイルと同じ場所に配置**すべき。docs/配下は例外的な使用に限定する
- **docs/配下に配置すべき場合**:
  1. **横断的な機能**: 複数のワークフロー、複数のファイルにまたがる機能
  2. **アーキテクチャ図**: 複数コンポーネント間の関係を示す図が必要
  3. **独立したセットアップガイド**: 初回設定など、特定のファイルに紐付かない手順
  4. **ユーザーガイド**: エンドユーザー向けの利用方法（実装詳細ではない）
- **docs/配下を避けるべき場合**:
  - 単一ワークフローの説明 → `.github/workflows/README.md`に記載
  - 単一スクリプトの説明 → ファイル内のdocstringに記載
  - 単一機能の説明 → 関連ファイルと同じディレクトリのREADMEに記載
- **内容**:
  - 詳細なアーキテクチャ
  - フローダイアグラム
  - 技術的な詳細説明
  - 詳細なトラブルシューティング
  - セキュリティ考慮事項
  - ベストプラクティス
- **良い例**: 
  - `docs/RELEASE_FLOW.md`: 3つのワークフローにまたがるRelease機能の全体アーキテクチャと連携フロー
  - `docs/LLM_API_SETUP.md`: 初回セットアップガイド（複数の設定箇所にまたがる）
  - `docs/USAGE.md`: エンドユーザー向け利用ガイド
- **悪い例**（避けるべき）:
  - `docs/WORKFLOWS.md`: 各ワークフローの個別説明 → `.github/workflows/README.md`に記載すべき
  - `docs/TEST_SCRIPT.md`: 単一スクリプトの説明 → スクリプト内のdocstringに記載すべき

## 作成してはいけないドキュメント

永続ドキュメント（README.md、docs/*.md など）には、以下のような内容を記載しないでください：

### リリースノート的な内容

- **禁止される表現**: 
  - 「以前は〜だった」「今回〜に変更した」「〜を修正した」といった過去形の説明
  - 「改善前」「改善後」「Before/After」などの比較表現
  - パフォーマンス改善の数値比較（「起動時間: 8秒 → 0.01秒」など）
  - 「〜を実装しました」「〜を追加しました」などの完了形
- **⚠️ 注意**: 「技術詳細」や「実装の説明」という名目でも、上記の表現が含まれる場合はリリースノートです
- **理由**: 永続ドキュメントは「現在の動作」を説明するものであり、変更履歴を記録するものではない
- **記載すべき場所**:
  - **PR説明文**: 変更内容の詳細な説明、Before/After比較、パフォーマンス改善結果
  - **Git コミットメッセージ**: 変更の理由と内容
  - **コード内のdocstring/コメント**: 実装の詳細（現在の動作のみ）

### 例

**悪い例（永続ドキュメントに記載してはいけない）:**

```markdown
## 認証機能

以前は Basic 認証を使用していましたが、セキュリティ上の問題があったため、
今回 OAuth 2.0 に変更しました。
```

**良い例（永続ドキュメントに記載すべき内容）:**

```markdown
## 認証機能

このシステムは OAuth 2.0 を使用して認証を行います。
```

**変更履歴はPR説明文に:**

```markdown
## 変更内容

Basic 認証から OAuth 2.0 に変更しました。

## 変更理由

Basic 認証にはセキュリティ上の問題があったため、より安全な OAuth 2.0 に移行しました。
```

**もう一つの悪い例（技術ドキュメントに見えてリリースノート）:**

```markdown
# パフォーマンス改善の詳細

## 改善前の状態
起動時に8〜12秒かかっていました。

## 改善後
遅延ロードを実装し、0.01秒に短縮しました。

## 改善率
99.9%削減
```

❌ これは「技術詳細」ではなく「変更履歴」です。PR説明文に記載してください。

**正しいアプローチ（コード内のdocstring）:**

```python
"""
AIエージェントモジュール

このモジュールは遅延ロード（Lazy Loading）を使用して、起動時間を最適化しています。
モデルとデータは初回の関数呼び出し時にロードされ、以降はキャッシュが使用されます。
"""
```

✅ 「現在の実装」のみを説明し、過去との比較はありません。

## DRY原則（Don't Repeat Yourself）

情報の重複を避け、単一情報源（Single Source of Truth）を維持してください：

### 重複を避けるべき内容

1. **詳細な技術説明**: 1つの専門ドキュメントに記載し、他のドキュメントからは参照リンクで誘導
2. **設定値**: コード（ワークフローファイルなど）を情報源とし、ドキュメントからは参照リンクを使用
3. **手順**: 1箇所に詳細を記載し、他の場所では要約+参照リンクを使用
4. **料金・プラン情報**: 詳細は専用セクションに記載し、他の箇所では概要+参照リンクのみ
5. **技術仕様（モデル名、バージョンなど）**: 具体的な値は1箇所のみに記載し、他は参照リンクを使用

### 参照リンクの使用

重複を避けるため、詳細情報へは参照リンクを使用してください：

```markdown
詳細なアーキテクチャについては [docs/RELEASE_FLOW.md](../../docs/RELEASE_FLOW.md) を参照してください。

設定値については [ワークフローファイル](upload-knowledge-to-release.yml) を参照してください。

無料で利用可能（詳細は[料金について](#料金について)を参照）
```

**悪い例（情報の重複）:**
```markdown
## メリット
- 無料で利用可能: Google Gemini 2.0 Flashの無料枠で十分に利用可能

## 料金について
Google Gemini 2.0 Flashは無料枠が提供されています...
```

**良い例（参照リンクで重複回避）:**
```markdown
## メリット
- 無料で利用可能（詳細は[料金について](#料金について)を参照）

## 料金について
Google Gemini 2.0 Flashは無料枠が提供されています...
```

### 情報の配置ルール

- **詳細情報は1箇所のみに記載**: 最も適切な専門ドキュメントに配置
- **概要は必要に応じて複数箇所に記載可**: ただし詳細へのリンクを含める
- **コードが情報源の場合**: ドキュメントには記載せず、コードへの参照リンクを使用

## 新規ドキュメント作成時のチェックリスト

新しいドキュメントを作成する前に、以下を確認してください：

1. **既存ドキュメントに追加できないか**: 既存の適切なドキュメントがあれば、そこに追加
2. **責任分掌は明確か**: このドキュメントの役割と対象読者が明確か
3. **重複はないか**: 他のドキュメントと重複する内容がないか
4. **参照リンクは適切か**: 詳細情報への適切な参照リンクがあるか
5. **⚠️ リリースノート的な内容が含まれていないか**: 以下の表現がある場合は削除
   - 「改善前」「改善後」「Before/After」などの比較
   - 「以前は〜」「今回〜に変更」「〜を修正した」などの過去形
   - パフォーマンス改善の数値比較（「8秒→0.01秒」など）
   - **これらは全てPR説明文に記載すべき内容です**

## 既存ドキュメント更新時のチェックリスト

ドキュメントを更新する際は、以下を確認してください：

1. **責任範囲内か**: そのドキュメントの責任範囲内の内容か
2. **重複が発生していないか**: 他のドキュメントとの重複が発生していないか
3. **参照リンクは更新されているか**: 関連する参照リンクが正しく更新されているか
4. **一貫性**: フォーマットやトーンが既存の内容と一貫しているか

## 例: 適切な配置

### 良い例

```markdown
# README.md
知識データはGitHub Releaseに自動的にアップロードされます。
詳細は [docs/RELEASE_FLOW.md](docs/RELEASE_FLOW.md) を参照してください。

# .github/workflows/README.md
### 知識データのRelease自動アップロード
「知識データの生成と保存」ワークフローで作成された暗号化知識データを、
GitHub Releaseとして自動的に公開するワークフローです。

詳細なアーキテクチャについては [docs/RELEASE_FLOW.md](../../docs/RELEASE_FLOW.md) を参照してください。

**トリガー**: `workflow_run` (「知識データの生成と保存」完了時)

# docs/RELEASE_FLOW.md
（ここに詳細なアーキテクチャ、フローダイアグラム、技術詳細を記載）
```

### 悪い例

```markdown
# README.md
知識データはGitHub Releaseに自動的にアップロードされます。
workflow_runトリガーを使用し、タイムスタンプベースのタグで...
（詳細すぎる）

# .github/workflows/README.md
### 知識データのRelease自動アップロード
このワークフローは以下の5つのステップで動作します：
1. アーティファクトをダウンロード...
2. タグ名を生成...
（workflows/README.mdの範囲を超えた詳細）

# docs/RELEASE_FLOW.md
（同じ内容が重複して記載されている）
```

---

このファイルは Copilot および自動生成ツール向けのドキュメント作成指示です。
